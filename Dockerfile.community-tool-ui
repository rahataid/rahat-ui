# Install dependencies only when needed
FROM node:20-alpine AS deps
WORKDIR /usr/src/app
COPY dist/apps/community-tool-ui/package.json ./

# Install build dependencies
RUN apk add --no-cache python3 make g++ 

RUN yarn install --production

FROM node:20-alpine AS runner
USER node
WORKDIR /usr/src/app
COPY --chown=node:node dist/apps/community-tool-ui ./
COPY --chown=node:node --from=deps /usr/src/app/node_modules ./node_modules
CMD [ "yarn", "start" ]
